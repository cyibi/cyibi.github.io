<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç« åˆ¥ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ï¼ˆå®Œå…¨å‹•ä½œç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 30px; background: #f2f2f2; }
    #chapter { font-size: 1.5em; margin-bottom: 10px; }
    #word { font-size: 2em; margin: 20px; color: #333; }
    #input { font-size: 1.2em; padding: 8px; width: 80%; max-width: 400px; }
    #result, #timer { margin-top: 20px; font-weight: bold; }
    #startBtn, #nextBtn, #retryBtn, #quitBtn {
      padding: 10px 20px; font-size: 1em; margin: 10px auto; display: block;
    }
    #nextBtn, #retryBtn, #quitBtn { display: none; }
    #retryBtn { background: orange; color: white; border: none; border-radius: 5px; }
    #quitBtn { background: #999; color: white; border: none; border-radius: 5px; }
    #ranking { margin-top: 30px; text-align: left; display: inline-block; background: #fff; padding: 10px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 6px 10px; border-bottom: 1px solid #ccc; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
</head>
<body>
  <h1>ç« åˆ¥ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ </h1>
  <div id="chapter"></div>
  <div id="word">ç« ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
  <input type="text" id="input" placeholder="ã“ã“ã«ã‚¿ã‚¤ãƒ”ãƒ³ã‚°" disabled />
  <button id="startBtn">ç¬¬1ç«  ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button id="nextBtn">æ¬¡ã®ç« ã¸é€²ã‚€</button>
  <button id="retryBtn">ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
  <button id="quitBtn">ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚ã‚‹</button>
  <div id="result"></div>
  <div id="timer">æ®‹ã‚Šæ™‚é–“: --ç§’</div>

  <div id="ranking">
    <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <table id="rankingTable">
      <tr><th>åå‰</th><th>ãƒŸã‚¹</th><th>ç« </th></tr>
    </table>
  </div>

  <script>
    // ğŸ”§ Firebaseã®è¨­å®šæƒ…å ±ï¼ˆã”è‡ªèº«ã®å€¤ã§å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰
    const firebaseConfig = {
      apiKey: "ã“ã“ã«è‡ªåˆ†ã®APIã‚­ãƒ¼",
      authDomain: "your-app.firebaseapp.com",
      databaseURL: "https://your-app.firebaseio.com",
      projectId: "your-app",
      storageBucket: "your-app.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const chapters = [
      { name: "ç¬¬1ç« ", words: ["cat","dog","sun","tree","book","car","pen","fish","home","milk"], maxMiss: 2 },
      { name: "ç¬¬2ç« ", words: ["window","purple","banana","coffee","guitar","planet","silver","yellow","butter","bridge"], maxMiss: 3 },
      { name: "ç¬¬3ç« ", words: ["elephant","mountains","adventure","developer","education","beautiful","javascript","direction","chocolate","performance"], maxMiss: 2 }
    ];

    let currentChapter = 0, currentWord = "", count = 0, misses = 0, startTime, timerId;
    const inputEl = document.getElementById("input");
    const wordEl = document.getElementById("word");
    const resultEl = document.getElementById("result");
    const chapterEl = document.getElementById("chapter");
    const timerEl = document.getElementById("timer");
    const startBtn = document.getElementById("startBtn");
    const nextBtn = document.getElementById("nextBtn");
    const retryBtn = document.getElementById("retryBtn");
    const quitBtn = document.getElementById("quitBtn");
    const table = document.getElementById("rankingTable");

    function startChapter() {
      [startBtn, nextBtn, retryBtn, quitBtn].forEach(btn => btn.style.display = "none");
      inputEl.disabled = false;
      inputEl.focus();
      count = 0;
      misses = 0;
      startTime = Date.now();
      updateTimer();
      timerId = setInterval(updateTimer, 1000);
      nextWord();
    }

    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const remaining = 60 - elapsed;
      timerEl.textContent = "æ®‹ã‚Šæ™‚é–“: " + remaining + "ç§’";
      if (remaining <= 0 || count >= 10) {
        clearInterval(timerId);
        inputEl.disabled = true;
        const chapter = chapters[currentChapter];
        if (misses > chapter.maxMiss) {
          resultEl.textContent = `å¤±æ•—â€¦ ãƒŸã‚¹: ${misses}å›ï¼ˆè¨±å®¹ ${chapter.maxMiss}å›ã¾ã§ï¼‰`;
          wordEl.textContent = "ãƒªãƒˆãƒ©ã‚¤ã‹ã€ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã§ãã¾ã™";
          retryBtn.style.display = "inline-block";
          quitBtn.style.display = "inline-block";
          return;
        }
        const rank = getRank(misses);
        resultEl.innerHTML = `ã‚¯ãƒªã‚¢ï¼ ãƒŸã‚¹: ${misses}å› - ãƒ©ãƒ³ã‚¯: ${rank}`;
        const name = prompt("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆåŒ¿åOKï¼‰:");
        if (name) db.ref("ranking").push({ name, misses, chapter: chapter.name });
        if (currentChapter < chapters.length - 1) {
          nextBtn.style.display = "block";
        } else {
          wordEl.textContent = "å…¨ç« ã‚¯ãƒªã‚¢ï¼ãŠç–²ã‚Œæ§˜ï¼";
          timerEl.textContent = "";
        }
        loadRanking();
      }
    }

    function getRank(miss) {
      if (miss === 0) return "S";
      if (miss <= 2) return "A";
      if (miss <= 4) return "B";
      if (miss <= 6) return "C";
      return "D";
    }

    function nextWord() {
      const chapter = chapters[currentChapter];
      currentWord = chapter.words[Math.floor(Math.random() * chapter.words.length)];
      wordEl.textContent = currentWord;
      inputEl.value = "";
      resultEl.textContent = "";
    }

    inputEl.addEventListener("input", () => {
      if (inputEl.value === currentWord) {
        count++;
        nextWord();
      } else if (!currentWord.startsWith(inputEl.value)) {
        misses++;
      }
    });

    startBtn.addEventListener("click", () => {
      chapterEl.textContent = chapters[currentChapter].name;
      startChapter();
    });

    nextBtn.addEventListener("click", () => {
      currentChapter++;
      chapterEl.textContent = chapters[currentChapter].name;
      startBtn.textContent = `${chapters[currentChapter].name} ã‚¹ã‚¿ãƒ¼ãƒˆ`;
      startBtn.style.display = "block";
      wordEl.textContent = "ç« ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„";
      resultEl.textContent = "";
    });

    retryBtn.addEventListener("click", () => {
      startBtn.textContent = `${chapters[currentChapter].name} ã‚¹ã‚¿ãƒ¼ãƒˆ`;
      startBtn.style.display = "block";
      resultEl.textContent = "";
      wordEl.textContent = "å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ãã¾ã™";
      retryBtn.style.display = "none";
      quitBtn.style.display = "none";
    });

    quitBtn.addEventListener("click", () => location.reload());

    function loadRanking() {
      table.innerHTML = "<tr><th>åå‰</th><th>ãƒŸã‚¹</th><th>ç« </th></tr>";
      db.ref("ranking").limitToLast(10).once("value", snapshot => {
        const data = snapshot.val();
        if (data) {
          const entries = Object.values(data).sort((a, b) => a.misses - b.misses);
          entries.forEach(entry => {
            const n = entry.name || "åç„¡ã—";
            const m = typeof entry.misses === "number" ? entry.misses : "ï¼Ÿ
